// Generated by CoffeeScript 1.6.2
'use strict';
var init, page, ph, phantom;

phantom = require('node-phantom');

page = null;

ph = null;

init = function(callback) {
  if (page !== null) {
    return callback(page);
  }
  return phantom.create(function(err, phCreated) {
    if (err) {
      return callback(err);
    }
    ph = phCreated;
    return ph.createPage(function(err, pageCreated) {
      if (err) {
        return callback(err);
      }
      page = pageCreated;
      return callback();
    });
  });
};

exports.loadPage = function(url, evalCb, resultCb) {
  return init(function() {
    return page.open(url, function(err, status) {
      if (err) {
        return callback(err);
      }
      return page.evaluate(evalCb, resultCb);
    });
  });
};

exports.exit = function() {
  return ph.exit();
};
